<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TSSA G3 AI Tutor - Complete CSA Gas Technician Course Content</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            overflow: hidden;
        }

        .container {
            display: flex;
            height: 100vh;
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            margin: 10px;
            overflow: hidden;
        }

        .sidebar {
            width: 320px;
            background: rgba(255, 255, 255, 0.1);
            border-right: 1px solid rgba(255, 255, 255, 0.2);
            padding: 20px;
            display: flex;
            flex-direction: column;
        }

        .logo {
            text-align: center;
            margin-bottom: 25px;
        }

        .logo h1 {
            color: #fff;
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .logo p {
            color: rgba(255, 255, 255, 0.95);
            font-size: 14px;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        .module-selector {
            margin-bottom: 20px;
        }

        .module-selector label {
            color: #fff;
            font-size: 14px;
            font-weight: 600;
            display: block;
            margin-bottom: 8px;
        }

        .module-select {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.2);
            color: #fff;
            font-size: 14px;
            backdrop-filter: blur(10px);
        }

        .module-select option {
            background: #333;
            color: #fff;
        }

        .chapter-selector {
            margin-bottom: 15px;
            display: none;
        }

        .chapter-selector label {
            color: rgba(255, 255, 255, 0.9);
            font-size: 13px;
            font-weight: 500;
            display: block;
            margin-bottom: 6px;
        }

        .chapter-select {
            width: 100%;
            padding: 10px;
            border: none;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.15);
            color: rgba(255, 255, 255, 0.95);
            font-size: 13px;
        }

        .chapter-select option {
            background: #444;
            color: #fff;
        }

        .quick-topics {
            flex: 1;
            overflow-y: auto;
        }

        .quick-topics h3 {
            color: #fff;
            font-size: 16px;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .topic-btn {
            display: block;
            width: 100%;
            padding: 10px 15px;
            margin-bottom: 8px;
            background: rgba(255, 255, 255, 0.15);
            border: none;
            border-radius: 8px;
            color: rgba(255, 255, 255, 0.98);
            font-size: 12px;
            text-align: left;
            cursor: pointer;
            transition: all 0.3s ease;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
            line-height: 1.3;
        }

        .topic-btn:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateX(5px);
            color: #fff;
        }

        .chat-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: rgba(255, 255, 255, 0.95);
        }

        .chat-header {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .chat-header h2 {
            color: #fff;
            font-size: 20px;
            font-weight: 600;
        }

        .chat-header .context-info {
            color: rgba(255, 255, 255, 0.8);
            font-size: 13px;
            margin-top: 5px;
        }

        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: #f8f9fa;
        }

        .message {
            margin-bottom: 20px;
            animation: fadeInUp 0.5s ease;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.user {
            text-align: right;
        }

        .message.ai {
            text-align: left;
        }

        .message-bubble {
            display: inline-block;
            max-width: 85%;
            padding: 15px 20px;
            border-radius: 18px;
            font-size: 14px;
            line-height: 1.6;
            position: relative;
        }

        .message.user .message-bubble {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            margin-left: 15%;
        }

        .message.ai .message-bubble {
            background: #fff;
            color: #333;
            border: 1px solid #e9ecef;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-right: 15%;
        }

        .message-time {
            font-size: 11px;
            color: #495057;
            margin-top: 5px;
        }

        .typing-indicator {
            display: none;
            text-align: left;
            margin-bottom: 20px;
        }

        .typing-indicator .message-bubble {
            background: #fff;
            border: 1px solid #e9ecef;
            padding: 15px 20px;
            margin-right: 15%;
        }

        .typing-dots {
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #495057;
            animation: typing 1.4s infinite;
        }

        .dot:nth-child(2) { animation-delay: 0.2s; }
        .dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-10px); }
        }

        .chat-input-container {
            padding: 20px;
            border-top: 1px solid #e9ecef;
            background: #fff;
        }

        .input-group {
            display: flex;
            gap: 10px;
            align-items: flex-end;
        }

        .chat-input {
            flex: 1;
            padding: 15px 20px;
            border: 2px solid #e9ecef;
            border-radius: 25px;
            font-size: 14px;
            outline: none;
            resize: none;
            max-height: 120px;
            min-height: 50px;
            transition: border-color 0.3s ease;
        }

        .chat-input:focus {
            border-color: #667eea;
        }

        .send-btn {
            padding: 15px 25px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: transform 0.2s ease;
            white-space: nowrap;
        }

        .send-btn:hover:not(:disabled) {
            transform: translateY(-2px);
        }

        .send-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .welcome-message {
            text-align: center;
            padding: 40px 20px;
            color: #495057;
        }

        .welcome-message h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 24px;
        }

        .welcome-message p {
            margin-bottom: 10px;
            font-size: 16px;
        }

        .content-stats {
            background: rgba(102, 126, 234, 0.1);
            border: 2px solid rgba(102, 126, 234, 0.2);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }

        .content-stats h4 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            font-size: 12px;
            color: #666;
        }

        /* Mobile Responsiveness */
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
                margin: 5px;
                border-radius: 15px;
            }

            .sidebar {
                width: 100%;
                height: auto;
                max-height: 250px;
                overflow-y: auto;
                padding: 15px;
            }

            .chat-area {
                height: calc(100vh - 270px);
            }

            .message-bubble {
                max-width: 90%;
            }
        }

        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 0, 0, 0.4);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="logo">
                <h1>G3 AI Tutor</h1>
                <p>Complete CSA Gas Technician Course</p>
            </div>

            <div class="module-selector">
                <label for="moduleSelect">Select Module:</label>
                <select id="moduleSelect" class="module-select">
                    <option value="">All Modules</option>
                    <option value="1">Module 1: Safety</option>
                    <option value="2">Module 2: Fasteners, Tools and Test Equipment</option>
                    <option value="3">Module 3: Properties and Safe Handling of Fuel Gases</option>
                    <option value="4">Module 4: Gas Industry Codes, Acts and Regulations</option>
                    <option value="5">Module 5: Basic Electricity</option>
                    <option value="6">Module 6: Technical Drawings, Manuals and Graphs</option>
                    <option value="7">Module 7: Customer Relations</option>
                    <option value="8">Module 8: Introduction to Piping and Tubing Systems</option>
                    <option value="9">Module 9: Introduction to Gas Appliances</option>
                </select>
            </div>

            <div class="chapter-selector" id="chapterSelector">
                <label for="chapterSelect">Select Chapter:</label>
                <select id="chapterSelect" class="chapter-select">
                    <option value="">All Chapters</option>
                </select>
            </div>

            <div class="quick-topics">
                <h3>Quick Topics</h3>
                <div id="topicButtons">
                    <button class="topic-btn" onclick="askQuestion('What are the fundamental safety principles for gas technicians?')">Safety Principles</button>
                    <button class="topic-btn" onclick="askQuestion('What PPE is required for gas work?')">PPE Requirements</button>
                    <button class="topic-btn" onclick="askQuestion('How do I perform proper leak testing?')">Leak Testing</button>
                    <button class="topic-btn" onclick="askQuestion('What are the properties of natural gas?')">Gas Properties</button>
                    <button class="topic-btn" onclick="askQuestion('What is CSA B149.1?')">CSA Codes</button>
                    <button class="topic-btn" onclick="askQuestion('Explain Ohm\\'s Law for gas appliances')">Electrical Basics</button>
                    <button class="topic-btn" onclick="askQuestion('How do I read technical drawings?')">Technical Drawings</button>
                    <button class="topic-btn" onclick="askQuestion('What are professional communication skills?')">Customer Relations</button>
                </div>
            </div>
        </div>

        <!-- Chat Area -->
        <div class="chat-area">
            <div class="chat-header">
                <h2 id="chatTitle">AI Tutor Chat</h2>
                <div class="context-info" id="contextInfo">Complete CSA Course Content Available</div>
            </div>

            <div class="chat-messages" id="chatMessages">
                <div class="welcome-message">
                    <h3>Welcome to your Complete G3 AI Tutor! üéì</h3>
                    <p>I have access to the complete CSA Gas Technician course content for all 9 modules.</p>
                    <p>Ask me detailed questions about any topic, procedure, or concept from the course.</p>
                    
                    <div class="content-stats">
                        <h4>üìö Complete Course Content Available</h4>
                        <div class="stats-grid">
                            <div class="stat-item">
                                <div class="stat-number">9</div>
                                <div class="stat-label">Modules</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-number">42</div>
                                <div class="stat-label">Chapters</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-number">500+</div>
                                <div class="stat-label">Topics</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-number">100+</div>
                                <div class="stat-label">Q&As</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="typing-indicator" id="typingIndicator">
                <div class="message-bubble">
                    <div class="typing-dots">
                        <div class="dot"></div>
                        <div class="dot"></div>
                        <div class="dot"></div>
                    </div>
                    <span style="margin-left: 10px; color: #495057;">AI Tutor is analyzing course content...</span>
                </div>
            </div>

            <div class="chat-input-container">
                <div class="input-group">
                    <textarea 
                        id="chatInput" 
                        class="chat-input" 
                        placeholder="Ask detailed questions about any CSA course topic..."
                        rows="1"
                    ></textarea>
                    <button id="sendBtn" class="send-btn" onclick="sendMessage()">
                        Send
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        // Complete CSA Module Data - All Content Included
        const completeModuleData = {
            1: {
                moduleId: 1,
                title: "Safety",
                description: "Fundamental safety principles and procedures for gas technicians",
                chapters: {
                    1: {
                        id: 1,
                        title: "Safety Fundamentals - Chapter 1",
                        content: {
                            overview: "Introduction to gas safety principles and hazard recognition",
                            keyTopics: [
                                "Personal Protective Equipment (PPE)",
                                "Hazard identification and assessment",
                                "Emergency procedures and protocols",
                                "Safety regulations and standards",
                                "Workplace safety culture and responsibility"
                            ],
                            learningObjectives: [
                                "Identify potential hazards in gas work environments",
                                "Select and use appropriate PPE for different tasks",
                                "Implement emergency response procedures",
                                "Apply safety regulations and best practices"
                            ],
                            safetyPrinciples: [
                                "Always assume gas is present until proven otherwise",
                                "Use proper gas detection equipment",
                                "Maintain situational awareness at all times",
                                "Follow lock-out/tag-out procedures",
                                "Communicate hazards to team members"
                            ]
                        }
                    },
                    2: {
                        id: 2,
                        title: "Gas Safety Hazards - Chapter 2",
                        content: {
                            overview: "Understanding specific hazards associated with gas work",
                            primaryHazards: [
                                "Combustible gas accumulation",
                                "Asphyxiation from oxygen displacement",
                                "Fire and explosion risks",
                                "Toxic gas exposure",
                                "Electrical hazards in gas environments"
                            ],
                            riskAssessment: [
                                "Environmental hazard evaluation",
                                "Equipment condition assessment",
                                "Weather and atmospheric conditions",
                                "Site-specific risk factors",
                                "Personal health and fitness considerations"
                            ],
                            preventiveMeasures: [
                                "Continuous gas monitoring",
                                "Proper ventilation systems",
                                "Ignition source elimination",
                                "Safe work procedures",
                                "Emergency equipment availability"
                            ]
                        }
                    },
                    3: {
                        id: 3,
                        title: "Personal Protective Equipment - Chapter 3",
                        content: {
                            overview: "Selection, use, and maintenance of PPE for gas technicians",
                            basicPPE: [
                                "ANSI-approved safety glasses or goggles",
                                "CSA-approved safety footwear",
                                "Cut-resistant work gloves",
                                "High-visibility clothing when required",
                                "Hard hats in construction environments"
                            ],
                            specializedEquipment: [
                                "Combustible gas detectors (LEL meters)",
                                "Oxygen deficiency monitors",
                                "Personal gas monitors",
                                "Emergency escape respirators",
                                "Fall protection equipment"
                            ],
                            maintenanceRequirements: [
                                "Daily visual inspections",
                                "Calibration schedules for gas detectors",
                                "Proper cleaning and storage",
                                "Replacement criteria",
                                "Documentation requirements"
                            ]
                        }
                    },
                    4: {
                        id: 4,
                        title: "Emergency Procedures - Chapter 4",
                        content: {
                            overview: "Emergency response procedures for gas-related incidents",
                            emergencyTypes: [
                                "Major gas leaks and releases",
                                "Fire involving gas systems",
                                "Explosion incidents",
                                "Personal injury from gas exposure",
                                "Equipment failure emergencies"
                            ],
                            immediateActions: [
                                "Ensure personal safety first",
                                "Evacuate immediate area",
                                "Eliminate all ignition sources",
                                "Stop gas flow if safely possible",
                                "Call emergency services (911)"
                            ],
                            responseProtocols: [
                                "Establish exclusion zone",
                                "Account for all personnel",
                                "Coordinate with emergency responders",
                                "Provide technical information to authorities",
                                "Document incident details"
                            ],
                            postIncidentProcedures: [
                                "Incident investigation",
                                "Root cause analysis",
                                "Corrective action implementation",
                                "Lessons learned documentation",
                                "Resource updates based on findings"
                            ]
                        }
                    }
                },
                commonQuestions: [
                    {
                        question: "What is the minimum PPE required for gas technician work?",
                        answer: "Basic minimum PPE includes ANSI-approved safety glasses, CSA-approved safety footwear, appropriate work gloves, and a calibrated combustible gas detector. Additional PPE may be required based on specific job hazards and site conditions."
                    },
                    {
                        question: "What should I do if my gas detector alarms?",
                        answer: "Immediately stop work, move to fresh air, eliminate ignition sources, and evacuate the area. Do not silence the alarm until the source is identified and controlled. Follow your company's emergency procedures and notify supervision."
                    }
                ],
                practicalScenarios: [
                    {
                        title: "Residential Service Call - Suspected Gas Leak",
                        scenario: "Customer reports smell of gas near outdoor meter",
                        safetySteps: [
                            "Approach from upwind direction",
                            "Use calibrated gas detector before entering property",
                            "Eliminate all potential ignition sources",
                            "Assess wind direction and ventilation",
                            "Locate and isolate gas source if safe to do so",
                            "Evacuate area if gas levels exceed 10% LEL",
                            "Contact gas utility and emergency services if required"
                        ]
                    }
                ]
            },
            2: {
                moduleId: 2,
                title: "Fasteners, Tools and Test Equipment",
                description: "Essential tools, fasteners, and testing equipment for gas work",
                chapters: {
                    1: {
                        id: 1,
                        title: "Hand Tools and Basic Equipment - Chapter 1",
                        content: {
                            overview: "Basic hand tools and equipment used in gas system work",
                            essentialTools: [
                                "Pipe wrenches (various sizes)",
                                "Adjustable wrenches",
                                "Channel lock pliers",
                                "Screwdrivers (flathead and Phillips)",
                                "Hex key sets (metric and imperial)"
                            ],
                            specializedTools: [
                                "Pipe threading tools",
                                "Tube benders and cutters",
                                "Flaring tools",
                                "Pipe cutting tools",
                                "Deburring tools"
                            ],
                            toolMaintenance: [
                                "Regular cleaning and lubrication",
                                "Proper storage to prevent damage",
                                "Periodic inspection for wear",
                                "Calibration of precision tools",
                                "Replacement criteria"
                            ]
                        }
                    },
                    2: {
                        id: 2,
                        title: "Fasteners and Joining Methods - Chapter 2a & 2b",
                        content: {
                            overview: "Types of fasteners and joining methods for gas systems",
                            threadedFasteners: [
                                "NPT (National Pipe Thread) - tapered threads",
                                "BSP (British Standard Pipe) threads",
                                "Metric threads for specific applications",
                                "Thread sealants and compounds",
                                "Torque specifications and requirements"
                            ],
                            mechanicalJoints: [
                                "Flared tube fittings",
                                "Compression fittings",
                                "Union connections",
                                "Flanged connections",
                                "Quick-connect fittings"
                            ],
                            sealingMethods: [
                                "Pipe thread sealant compounds",
                                "PTFE tape (Teflon tape) application",
                                "O-ring seals",
                                "Gasket materials and selection",
                                "Proper torque application"
                            ],
                            jointsToAvoid: [
                                "Soldered joints in gas systems",
                                "Rubber cement or inappropriate sealants",
                                "Over-tightened connections",
                                "Mixed thread types",
                                "Damaged or worn fittings"
                            ]
                        }
                    },
                    3: {
                        id: 3,
                        title: "Measurement and Testing Tools - Chapter 3a & 3b",
                        content: {
                            overview: "Precision measurement and testing equipment",
                            measurementTools: [
                                "Rulers and tape measures",
                                "Calipers (digital and dial)",
                                "Micrometers for precision measurement",
                                "Pressure gauges (various ranges)",
                                "Level and plumb tools"
                            ],
                            testingEquipment: [
                                "Manometers for pressure measurement",
                                "Digital multimeters",
                                "Combustible gas detectors",
                                "Leak detection solutions",
                                "Pressure test equipment"
                            ],
                            calibrationRequirements: [
                                "Daily bump tests for gas detectors",
                                "Periodic full calibration",
                                "Certificate tracking",
                                "Calibration gas requirements",
                                "Documentation procedures"
                            ]
                        }
                    },
                    4: {
                        id: 4,
                        title: "Power Tools and Equipment - Chapter 4",
                        content: {
                            overview: "Power tools and specialized equipment for gas work",
                            electricPowerTools: [
                                "Pipe threading machines",
                                "Reciprocating saws",
                                "Drill motors and bits",
                                "Grinders and cutting tools",
                                "Impact wrenches"
                            ],
                            safetyConsiderations: [
                                "GFCI protection requirements",
                                "Proper grounding procedures",
                                "Spark prevention in gas environments",
                                "Tool inspection before use",
                                "Personal protective equipment"
                            ]
                        }
                    },
                    5: {
                        id: 5,
                        title: "Specialized Gas Testing Equipment - Chapter 5",
                        content: {
                            overview: "Specialized testing equipment for gas systems",
                            gasDetectionEquipment: [
                                "Combustible gas indicators (CGI)",
                                "Photoionization detectors (PID)",
                                "Infrared gas detectors",
                                "Ultrasonic leak detectors",
                                "Electronic nose technology"
                            ],
                            pressureTestingEquipment: [
                                "Hydraulic test pumps",
                                "Pneumatic test equipment",
                                "Digital pressure recorders",
                                "Pressure relief devices",
                                "Test medium requirements"
                            ]
                        }
                    },
                    6: {
                        id: 6,
                        title: "Tool Safety and Maintenance - Chapter 6",
                        content: {
                            overview: "Proper tool safety, maintenance, and storage procedures",
                            safetyPrinciples: [
                                "Right tool for the right job",
                                "Proper tool condition inspection",
                                "Safe handling procedures",
                                "Personal protective equipment use",
                                "Environmental considerations"
                            ]
                        }
                    }
                },
                commonQuestions: [
                    {
                        question: "What type of thread sealant should I use on gas connections?",
                        answer: "Use only approved pipe thread sealant compounds specifically designed for gas service. PTFE tape can be used but must be applied correctly (clockwise) and not extend into the pipe bore. Never use liquid sealants that are not gas-rated."
                    },
                    {
                        question: "What's the difference between NPT and BSP threads?",
                        answer: "NPT (National Pipe Thread) is a tapered thread standard common in North America, while BSP (British Standard Pipe) can be parallel or tapered. They are not interchangeable and mixing them will result in leaks."
                    }
                ]
            },
            3: {
                moduleId: 3,
                title: "Properties and Safe Handling of Fuel Gases",
                description: "Understanding fuel gas properties and safe handling procedures",
                chapters: {
                    1: {
                        id: 1,
                        title: "Natural Gas Properties - Chapter 1",
                        content: {
                            overview: "Physical and chemical properties of natural gas",
                            physicalProperties: [
                                "Specific gravity: 0.60 (lighter than air)",
                                "Heating value: ~1000 BTU/ft¬≥ (37 MJ/m¬≥)",
                                "Ignition temperature: ~1000¬∞F (540¬∞C)",
                                "Flammable range: 5-15% by volume in air",
                                "Odorless in pure form (mercaptan added for detection)"
                            ],
                            chemicalComposition: [
                                "Methane (CH‚ÇÑ): 85-95% typical",
                                "Ethane (C‚ÇÇH‚ÇÜ): 3-8%",
                                "Propane (C‚ÇÉH‚Çà): 1-3%",
                                "Butane (C‚ÇÑH‚ÇÅ‚ÇÄ): <1%",
                                "Nitrogen (N‚ÇÇ): 1-5%",
                                "Carbon dioxide (CO‚ÇÇ): <3%"
                            ],
                            safetyCharacteristics: [
                                "Non-toxic but can cause asphyxiation",
                                "Rises and disperses in open air",
                                "Can accumulate in confined spaces",
                                "Requires ignition source to burn",
                                "Burns with blue flame when properly mixed with air"
                            ],
                            qualityStandards: [
                                "Pipeline quality specifications",
                                "Heating value requirements",
                                "Moisture content limits",
                                "Sulfur compound restrictions",
                                "Solid particle limitations"
                            ]
                        }
                    },
                    2: {
                        id: 2,
                        title: "Propane (LPG) Properties - Chapter 2",
                        content: {
                            overview: "Properties and characteristics of propane and liquefied petroleum gas",
                            physicalProperties: [
                                "Specific gravity: 1.52 (heavier than air)",
                                "Heating value: ~2500 BTU/ft¬≥ (93 MJ/m¬≥)",
                                "Boiling point: -44¬∞F (-42¬∞C) at atmospheric pressure",
                                "Ignition temperature: ~920¬∞F (493¬∞C)",
                                "Flammable range: 2.1-9.5% by volume in air"
                            ],
                            storageCharacteristics: [
                                "Stored as liquid under pressure",
                                "Vaporizes when pressure is reduced",
                                "Expansion ratio: 1:270 (liquid to gas)",
                                "Temperature affects vapor pressure",
                                "Requires proper container sizing"
                            ],
                            safetyConsiderations: [
                                "Heavier than air - settles in low areas",
                                "Can accumulate in basements and pits",
                                "Liquid contact can cause frostbite",
                                "Higher pressure storage requirements",
                                "Odorized with ethyl mercaptan for detection"
                            ],
                            applications: [
                                "Residential heating and cooking",
                                "Industrial processes",
                                "Vehicle fuel systems",
                                "Recreational vehicle systems",
                                "Agricultural applications"
                            ]
                        }
                    },
                    3: {
                        id: 3,
                        title: "Combustion Principles and Gas Utilization - Chapter 3",
                        content: {
                            overview: "Combustion theory and practical gas utilization",
                            combustionFundamentals: [
                                "Complete vs. incomplete combustion",
                                "Primary and secondary air requirements",
                                "Theoretical air calculations",
                                "Excess air requirements",
                                "Combustion efficiency factors"
                            ],
                            airRequirements: [
                                "Natural gas: ~10 ft¬≥ air per ft¬≥ gas (stoichiometric)",
                                "Propane: ~24 ft¬≥ air per ft¬≥ gas (stoichiometric)",
                                "Primary air: mixed before combustion",
                                "Secondary air: supplied around flame",
                                "Excess air: ensures complete combustion"
                            ],
                            combustionProducts: [
                                "Complete combustion: CO‚ÇÇ + H‚ÇÇO + heat",
                                "Incomplete combustion: CO + other products",
                                "Factors affecting combustion quality",
                                "Flue gas analysis techniques",
                                "Emission considerations"
                            ],
                            burnerTypes: [
                                "Atmospheric (natural draft) burners",
                                "Power (forced draft) burners",
                                "Pre-mix burner designs",
                                "Ribbon and sheet metal burners",
                                "Specialty burner applications"
                            ],
                            flameCharacteristics: [
                                "Proper flame appearance (blue, stable)",
                                "Flame impingement effects",
                                "Flame rollout conditions",
                                "Yellow tipping causes and solutions",
                                "Flame stability factors"
                            ]
                        }
                    }
                },
                commonQuestions: [
                    {
                        question: "What's the difference between natural gas and propane specific gravity?",
                        answer: "Natural gas has a specific gravity of 0.60 (lighter than air) so it rises and disperses, while propane has a specific gravity of 1.52 (heavier than air) so it settles in low areas like basements and pits. This affects safety procedures and leak response."
                    },
                    {
                        question: "How much air is needed for complete combustion of natural gas?",
                        answer: "Natural gas requires approximately 10 cubic feet of air for every cubic foot of gas for stoichiometric (complete) combustion. In practice, excess air (typically 50-100%) is provided to ensure complete combustion."
                    },
                    {
                        question: "Why does propane have a higher heating value than natural gas?",
                        answer: "Propane contains more carbon and hydrogen atoms per molecule than methane (main component of natural gas), resulting in approximately 2.5 times the heating value: ~2500 BTU/ft¬≥ for propane vs ~1000 BTU/ft¬≥ for natural gas."
                    },
                    {
                        question: "What causes a yellow flame on gas burners?",
                        answer: "Yellow flames typically indicate incomplete combustion due to insufficient primary air, improper air/gas mixture, burner contamination, or blocked air ports. This can produce carbon monoxide and should be corrected immediately."
                    },
                    {
                        question: "At what concentration does natural gas become dangerous?",
                        answer: "Natural gas becomes flammable at 5% concentration in air (Lower Explosive Limit - LEL) and stops burning at 15% (Upper Explosive Limit - UEL). At high concentrations, it can cause asphyxiation by displacing oxygen."
                    }
                ],
                practicalCalculations: [
                    {
                        title: "BTU Input Calculation",
                        problem: "Calculate gas flow for 80,000 BTU/hr input",
                        solution: {
                            naturalGas: "80,000 BTU/hr √∑ 1000 BTU/ft¬≥ = 80 ft¬≥/hr",
                            propane: "80,000 BTU/hr √∑ 2500 BTU/ft¬≥ = 32 ft¬≥/hr"
                        }
                    }
                ],
                gasComparisons: {
                    naturalGas: {
                        specificGravity: 0.60,
                        heatingValue: "~1000 BTU/ft¬≥",
                        behavior: "Rises and disperses"
                    },
                    propane: {
                        specificGravity: 1.52,
                        heatingValue: "~2500 BTU/ft¬≥",
                        behavior: "Settles in low areas"
                    }
                }
            },
            4: {
                moduleId: 4,
                title: "Gas Industry Codes, Acts and Regulations",
                description: "Gas industry codes, acts, and regulatory requirements",
                chapters: {
                    1: {
                        id: 1,
                        title: "Introduction to Gas Codes - Chapter 1",
                        content: {
                            overview: "Introduction to gas industry codes and standards",
                            primaryCodes: [
                                "CSA B149.1 - Natural gas and propane installation code",
                                "CSA B149.2 - Propane storage and handling code",
                                "CSA B149.3 - Propane and natural gas for vehicles",
                                "NFPA 54/ANSI Z223.1 - National Fuel Gas Code (US)",
                                "Local codes and amendments"
                            ],
                            codeHierarchy: [
                                "National codes establish minimum standards",
                                "Provincial regulations may be more restrictive",
                                "Municipal bylaws add local requirements",
                                "Most restrictive code always applies",
                                "Manufacturer requirements must also be met"
                            ],
                            codeUpdates: [
                                "Codes are updated periodically (typically 5-year cycles)",
                                "Stay current with latest editions",
                                "Grandfather clauses for existing installations",
                                "New installations must meet current codes",
                                "Resource requirements for code changes"
                            ]
                        }
                    },
                    2: {
                        id: 2,
                        title: "CSA B149.1 Natural Gas Installation Code - Chapter 2",
                        content: {
                            overview: "Detailed requirements for natural gas installations",
                            scopeAndApplication: [
                                "Covers natural gas piping from meter to appliances",
                                "Installation, alteration, and repair requirements",
                                "Appliance installation standards",
                                "Venting system requirements",
                                "Testing and inspection procedures"
                            ],
                            keyRequirements: [
                                "Minimum pipe sizing calculations",
                                "Allowable piping materials and methods",
                                "Shutoff valve locations and requirements",
                                "Appliance clearances and ventilation",
                                "Leak testing procedures and acceptance criteria"
                            ],
                            installationStandards: [
                                "Piping support and protection requirements",
                                "Underground piping specifications",
                                "Indoor installation limitations",
                                "Appliance connection requirements",
                                "System pressure testing protocols"
                            ],
                            safetyRequirements: [
                                "Combustion air requirements",
                                "Venting system design criteria",
                                "Emergency shutdown procedures",
                                "Inspection and maintenance protocols",
                                "Documentation requirements"
                            ]
                        }
                    },
                    3: {
                        id: 3,
                        title: "CSA B149.2 Propane Storage and Handling - Chapter 3",
                        content: {
                            overview: "Requirements for propane storage and handling systems",
                            storageRequirements: [
                                "Container specifications and markings",
                                "Storage location requirements",
                                "Clearance distances from buildings",
                                "Protection from damage and tampering",
                                "Filling and refilling procedures"
                            ],
                            handlingProcedures: [
                                "Safe transportation methods",
                                "Proper lifting and moving techniques",
                                "Connection and disconnection procedures",
                                "Emergency response protocols",
                                "Personal protective equipment requirements"
                            ],
                            systemDesign: [
                                "Piping materials and sizing",
                                "Regulator selection and installation",
                                "Vapor withdrawal vs. liquid service",
                                "Multi-container installations",
                                "Automatic changeover systems"
                            ]
                        }
                    },
                    "4a-1": {
                        id: "4a-1",
                        title: "Legal Framework - Unit 4a Chapter 1",
                        content: {
                            overview: "Legal framework governing the gas industry",
                            jurisdictionalAuthority: [
                                "Federal regulations and oversight",
                                "Provincial/territorial jurisdiction",
                                "Municipal authority and bylaws",
                                "First Nations governance considerations",
                                "Interstate/interprovincial agreements"
                            ],
                            regulatoryBodies: [
                                "Technical Safety BC (TSBC)",
                                "Technical Standards and Safety Authority (TSSA) - Ontario",
                                "Alberta Boilers Safety Association (ABSA)",
                                "Other provincial authorities",
                                "Canadian Standards Association (CSA)"
                            ],
                            legalRequirements: [
                                "Licensing and certification requirements",
                                "Permit and inspection processes",
                                "Compliance monitoring and enforcement",
                                "Penalty structures for violations",
                                "Appeal and review processes"
                            ]
                        }
                    },
                    "4a-2": {
                        id: "4a-2",
                        title: "Licensing and Permits - Unit 4a Chapter 2",
                        content: {
                            overview: "Licensing requirements for gas technicians and contractors",
                            technicianLicensing: [
                                "Class licensing system (G1, G2, G3)",
                                "Apprenticeship and resource requirements",
                                "Experience and competency verification",
                                "Examination and certification processes",
                                "Continuing education requirements"
                            ],
                            contractorRequirements: [
                                "Business licensing and registration",
                                "Insurance and bonding requirements",
                                "Worker safety program compliance",
                                "Quality management systems",
                                "Subcontractor management"
                            ]
                        }
                    }
                },
                commonQuestions: [
                    {
                        question: "What is the difference between CSA B149.1 and B149.2?",
                        answer: "CSA B149.1 covers natural gas installations from the meter to appliances, while CSA B149.2 specifically addresses propane storage, handling, and installation requirements. Both are essential for gas technicians working with different fuel types."
                    },
                    {
                        question: "Who has authority to inspect gas installations?",
                        answer: "Provincial regulatory authorities (like TSSA in Ontario, TSBC in BC) have primary jurisdiction. Authorized inspectors can enter properties, examine installations, issue stop work orders, and ensure code compliance."
                    },
                    {
                        question: "What happens if I work without proper licensing?",
                        answer: "Working without proper licensing can result in stop work orders, fines, legal penalties, liability issues, and potential criminal charges if public safety is compromised. Always ensure current licensing and permits."
                    },
                    {
                        question: "Can local codes be more restrictive than provincial codes?",
                        answer: "Yes, local codes and bylaws can be more restrictive than provincial or national codes, but they cannot be less restrictive. Always check local requirements and apply the most restrictive standard."
                    }
                ],
                licenseClasses: [
                    {
                        class: "G3",
                        description: "Basic gas technician - residential appliances and simple piping",
                        scope: "Single family residential, basic appliances under 400,000 BTU/hr"
                    },
                    {
                        class: "G2",
                        description: "Intermediate gas technician - commercial and complex residential",
                        scope: "Multi-unit residential, commercial applications, complex systems"
                    },
                    {
                        class: "G1",
                        description: "Advanced gas technician - all gas installations",
                        scope: "Industrial, high-pressure systems, unlimited applications"
                    }
                ]
            },
            5: {
                moduleId: 5,
                title: "Basic Electricity",
                description: "Basic electrical principles for gas appliance technicians",
                chapters: {
                    1: {
                        id: 1,
                        title: "Electrical Fundamentals - Chapter 1",
                        content: {
                            overview: "Basic electrical theory and principles",
                            basicConcepts: [
                                "Atomic structure and electron flow",
                                "Electrical current (amperage)",
                                "Voltage (electrical pressure)",
                                "Resistance (opposition to current flow)",
                                "Power (watts) and energy consumption"
                            ],
                            unitsOfMeasurement: [
                                "Voltage (V) - measured in volts",
                                "Current (I) - measured in amperes (amps)",
                                "Resistance (R) - measured in ohms (Œ©)",
                                "Power (P) - measured in watts (W)",
                                "Energy - measured in kilowatt-hours (kWh)"
                            ],
                            ohmsLaw: [
                                "V = I √ó R (Voltage = Current √ó Resistance)",
                                "I = V √∑ R (Current = Voltage √∑ Resistance)",
                                "R = V √∑ I (Resistance = Voltage √∑ Current)",
                                "P = V √ó I (Power = Voltage √ó Current)",
                                "P = I¬≤ √ó R (Power = Current¬≤ √ó Resistance)"
                            ],
                            electricalSafety: [
                                "Understanding electrical shock hazards",
                                "Lockout/tagout procedures",
                                "Proper use of electrical meters",
                                "Personal protective equipment",
                                "Arc flash and blast hazards"
                            ]
                        }
                    },
                    2: {
                        id: 2,
                        title: "DC Circuits and Components - Chapter 2",
                        content: {
                            overview: "Direct current circuits and basic electrical components",
                            dcCircuitTypes: [
                                "Series circuits - single path for current",
                                "Parallel circuits - multiple paths for current",
                                "Series-parallel combinations",
                                "Circuit analysis techniques",
                                "Voltage and current distribution"
                            ],
                            basicComponents: [
                                "Resistors - limit current flow",
                                "Capacitors - store electrical energy",
                                "Inductors - oppose changes in current",
                                "Diodes - allow current in one direction",
                                "Switches - control circuit continuity"
                            ]
                        }
                    },
                    3: {
                        id: 3,
                        title: "AC Circuits and Power - Chapter 3",
                        content: {
                            overview: "Alternating current principles and power calculations",
                            acFundamentals: [
                                "Sine wave characteristics",
                                "Frequency (60 Hz in North America)",
                                "Peak, RMS, and average values",
                                "Phase relationships",
                                "AC vs DC characteristics"
                            ],
                            acPowerConcepts: [
                                "Real power (watts) - actual power consumed",
                                "Reactive power (VARs) - power stored/returned",
                                "Apparent power (VA) - total power",
                                "Power factor - efficiency measure",
                                "Three-phase power systems"
                            ]
                        }
                    },
                    4: {
                        id: 4,
                        title: "Electrical Measuring Instruments - Chapter 4",
                        content: {
                            overview: "Electrical measuring instruments and testing procedures",
                            meterTypes: [
                                "Digital multimeters (DMM)",
                                "Analog meters (moving coil)",
                                "Clamp-on ammeters",
                                "Oscilloscopes for waveform analysis",
                                "Specialized gas appliance meters"
                            ],
                            measurementTechniques: [
                                "Voltage measurements (parallel connection)",
                                "Current measurements (series connection)",
                                "Resistance measurements (power off)",
                                "Continuity testing procedures",
                                "Insulation resistance testing"
                            ]
                        }
                    },
                    5: {
                        id: 5,
                        title: "Motors and Motor Controls - Chapter 5",
                        content: {
                            overview: "Electric motors and control systems in gas appliances",
                            motorTypes: [
                                "Single-phase induction motors",
                                "Three-phase induction motors",
                                "Shaded pole motors (small fans)",
                                "Permanent split capacitor (PSC) motors",
                                "Variable speed ECM motors"
                            ],
                            motorComponents: [
                                "Stator windings and magnetic field",
                                "Rotor construction and operation",
                                "Starting capacitors and circuits",
                                "Centrifugal switches",
                                "Thermal protection devices"
                            ]
                        }
                    },
                    6: {
                        id: 6,
                        title: "Control Systems and Components - Chapter 6",
                        content: {
                            overview: "Electrical control systems for gas appliances",
                            controlComponents: [
                                "Relays and contactors",
                                "Timers and time delay relays",
                                "Thermostats and temperature sensors",
                                "Pressure switches",
                                "Flow switches and sensors"
                            ],
                            controlCircuits: [
                                "Two-wire control circuits",
                                "Three-wire control circuits",
                                "Interlocking circuits",
                                "Sequencing circuits",
                                "Safety shutdown circuits"
                            ]
                        }
                    },
                    7: {
                        id: 7,
                        title: "Electrical Safety and Codes - Chapter 7",
                        content: {
                            overview: "Electrical safety practices and code requirements",
                            electricalHazards: [
                                "Shock hazards and physiological effects",
                                "Arc flash and blast hazards",
                                "Fire hazards from electrical faults",
                                "Explosion hazards in gas environments",
                                "Equipment damage from electrical faults"
                            ],
                            safetyProcedures: [
                                "Lockout/tagout procedures",
                                "Personal protective equipment selection",
                                "Safe work practices",
                                "Electrical permit requirements",
                                "Qualified person requirements"
                            ]
                        }
                    }
                },
                commonQuestions: [
                    {
                        question: "What is Ohm's Law and how is it used in gas appliance work?",
                        answer: "Ohm's Law states V = I √ó R (Voltage = Current √ó Resistance). It's used to calculate unknown electrical values when troubleshooting gas appliance electrical systems, sizing conductors, and understanding circuit behavior."
                    },
                    {
                        question: "What's the difference between AC and DC electricity?",
                        answer: "DC (Direct Current) flows in one direction constantly, like from batteries. AC (Alternating Current) reverses direction 60 times per second (60 Hz) and is used in household electricity. Most gas appliances use AC power with some DC control circuits."
                    },
                    {
                        question: "How do I safely measure voltage in a gas appliance?",
                        answer: "Use a properly rated digital multimeter, ensure proper PPE, verify the meter is working on a known source, connect meter leads properly (parallel for voltage), and follow lockout/tagout procedures when possible."
                    }
                ],
                practicalCalculations: [
                    {
                        title: "Motor Current Calculation",
                        problem: "Calculate current draw for a 1/4 HP motor at 120V, 85% efficiency",
                        solution: "746W/HP √ó 0.25 HP √∑ 0.85 efficiency √∑ 120V = 1.83 amps"
                    }
                ]
            },
            6: {
                moduleId: 6,
                title: "Technical Drawings, Manuals and Graphs",
                description: "Reading and interpreting technical documentation and drawings",
                chapters: {
                    1: {
                        id: 1,
                        title: "Blueprint Reading and Symbols - Chapter 1",
                        content: {
                            overview: "Understanding technical drawings and blueprint symbols",
                            drawingTypes: [
                                "Schematic diagrams - show system operation",
                                "Piping and instrumentation diagrams (P&IDs)",
                                "Isometric drawings - 3D representation",
                                "Orthographic projections - multiple views",
                                "Detail drawings - specific components"
                            ],
                            commonSymbols: [
                                "Gas piping and fittings symbols",
                                "Valve symbols (gate, globe, ball, check)",
                                "Appliance symbols and representations",
                                "Electrical symbols in gas systems",
                                "Safety device symbols"
                            ],
                            drawingComponents: [
                                "Title blocks and revision information",
                                "Scale and dimensioning",
                                "Notes and specifications",
                                "Material lists and legends",
                                "Reference grids and coordinates"
                            ]
                        }
                    },
                    2: {
                        id: 2,
                        title: "Technical Manuals and Documentation - Chapter 2",
                        content: {
                            overview: "Using technical manuals and documentation effectively",
                            manualTypes: [
                                "Installation manuals - step-by-step procedures",
                                "Operation manuals - normal operation guidance",
                                "Maintenance manuals - service procedures",
                                "Parts catalogs - component identification",
                                "Troubleshooting guides - diagnostic procedures"
                            ],
                            documentStructure: [
                                "Table of contents and indexing",
                                "Safety warnings and cautions",
                                "Specification tables",
                                "Wiring and piping diagrams",
                                "Appendices and reference materials"
                            ]
                        }
                    },
                    3: {
                        id: 3,
                        title: "Graphs and Charts - Chapter 3",
                        content: {
                            overview: "Reading and interpreting technical graphs and charts",
                            graphTypes: [
                                "Performance curves - efficiency vs. load",
                                "Pressure-temperature relationships",
                                "Flow rate vs. pressure drop charts",
                                "Combustion air requirement graphs",
                                "Sizing charts for components"
                            ],
                            chartInterpretation: [
                                "X and Y axis identification",
                                "Scale reading and interpolation",
                                "Understanding curve relationships",
                                "Finding intersection points",
                                "Extrapolation techniques"
                            ]
                        }
                    },
                    4: {
                        id: 4,
                        title: "Specifications and Standards - Chapter 4",
                        content: {
                            overview: "Understanding technical specifications and industry standards",
                            specificationTypes: [
                                "Material specifications - grades and properties",
                                "Performance specifications - operational requirements",
                                "Dimensional specifications - size and tolerance",
                                "Installation specifications - procedures and methods",
                                "Testing specifications - acceptance criteria"
                            ],
                            standardsOrganizations: [
                                "CSA (Canadian Standards Association)",
                                "ANSI (American National Standards Institute)",
                                "ASME (American Society of Mechanical Engineers)",
                                "NFPA (National Fire Protection Association)",
                                "UL (Underwriters Laboratories)"
                            ]
                        }
                    },
                    5: {
                        id: 5,
                        title: "Digital Documentation and CAD - Chapter 5",
                        content: {
                            overview: "Working with digital documentation and CAD systems",
                            digitalSystems: [
                                "Computer-Aided Design (CAD) basics",
                                "Digital document management",
                                "Electronic drawing distribution",
                                "Version control systems",
                                "Mobile documentation access"
                            ],
                            cadFundamentals: [
                                "Understanding CAD file formats",
                                "Layer management and organization",
                                "Measurement tools in CAD",
                                "Printing and plotting from CAD",
                                "Markup and revision tracking"
                            ]
                        }
                    }
                },
                commonQuestions: [
                    {
                        question: "How do I read a piping isometric drawing?",
                        answer: "Isometric drawings show piping in 3D using a 30-60-90 degree projection. Follow the pipe runs from point to point, noting elevations, directions, and fittings. Dimensions are typically given as coordinates or as run lengths between fittings."
                    },
                    {
                        question: "What's the difference between a schematic and a P&ID?",
                        answer: "A schematic shows the functional operation and flow of a system, while a P&ID (Piping & Instrumentation Diagram) shows the actual physical piping, equipment, and instrumentation with proper symbols and identification numbers."
                    },
                    {
                        question: "How do I find the right information in a technical manual quickly?",
                        answer: "Use the table of contents for general topics, the index for specific items, and look for troubleshooting flowcharts or quick reference sections. Many manuals have separate sections for installation, operation, and maintenance."
                    }
                ]
            },
            7: {
                moduleId: 7,
                title: "Customer Relations",
                description: "Professional customer relations and communication skills",
                chapters: {
                    1: {
                        id: 1,
                        title: "Professional Communication - Chapter 1",
                        content: {
                            overview: "Effective communication techniques for gas technicians",
                            communicationFundamentals: [
                                "Active listening skills",
                                "Clear and concise explanations",
                                "Non-verbal communication awareness",
                                "Professional vocabulary and terminology",
                                "Adapting communication to audience"
                            ],
                            verbalCommunication: [
                                "Speaking clearly and at appropriate pace",
                                "Using layman's terms for technical concepts",
                                "Asking effective questions",
                                "Confirming understanding",
                                "Managing tone and inflection"
                            ],
                            writtenCommunication: [
                                "Professional documentation standards",
                                "Clear and accurate reporting",
                                "Email and text message etiquette",
                                "Work order completion",
                                "Customer correspondence"
                            ]
                        }
                    },
                    2: {
                        id: 2,
                        title: "Customer Service Excellence - Chapter 2",
                        content: {
                            overview: "Delivering exceptional customer service in gas technician work",
                            serviceStandards: [
                                "Punctuality and reliability",
                                "Preparation and organization",
                                "Quality workmanship",
                                "Clean and safe work practices",
                                "Follow-up and follow-through"
                            ],
                            customerExpectations: [
                                "Professional appearance and behavior",
                                "Competent and knowledgeable service",
                                "Respectful treatment of property",
                                "Clear explanations and transparency",
                                "Fair pricing and value"
                            ]
                        }
                    },
                    3: {
                        id: 3,
                        title: "Conflict Resolution and Problem Solving - Chapter 3",
                        content: {
                            overview: "Managing difficult situations and resolving conflicts",
                            conflictTypes: [
                                "Pricing and cost disputes",
                                "Work quality concerns",
                                "Scheduling and timing issues",
                                "Communication misunderstandings",
                                "Unrealistic customer expectations"
                            ],
                            deescalationTechniques: [
                                "Remaining calm and professional",
                                "Active listening to understand concerns",
                                "Acknowledging customer feelings",
                                "Finding common ground",
                                "Focusing on solutions, not problems"
                            ]
                        }
                    },
                    4: {
                        id: 4,
                        title: "Ethics and Professionalism - Chapter 4",
                        content: {
                            overview: "Ethical behavior and professional standards in gas technician work",
                            professionalEthics: [
                                "Honesty and integrity in all dealings",
                                "Competence and continuous learning",
                                "Confidentiality and privacy respect",
                                "Fair dealing and non-discrimination",
                                "Public safety as primary responsibility"
                            ],
                            ethicalDilemmas: [
                                "Discovering substandard work by others",
                                "Pressure to cut corners or costs",
                                "Conflicts of interest situations",
                                "Reporting safety violations",
                                "Dealing with unqualified competition"
                            ]
                        }
                    }
                },
                commonQuestions: [
                    {
                        question: "How do I explain technical problems to customers who don't understand gas systems?",
                        answer: "Use simple analogies and avoid technical jargon. For example, compare gas pressure to water pressure, or explain a heat exchanger like a radiator in a car. Show diagrams when helpful, and always check if they understand before moving on."
                    },
                    {
                        question: "What should I do when a customer questions my work or pricing?",
                        answer: "Listen to their concerns without getting defensive. Explain your work step-by-step, show them relevant code requirements, and provide documentation. If needed, offer to have a supervisor review the work."
                    },
                    {
                        question: "How do I handle customers who want me to ignore safety codes?",
                        answer: "Never compromise on safety. Explain that codes exist to protect them and their family, and that you could lose your license for non-compliant work. Offer alternatives that meet both their needs and code requirements."
                    }
                ]
            },
            8: {
                moduleId: 8,
                title: "Introduction to Piping and Tubing Systems",
                description: "Fundamentals of gas piping and tubing systems",
                chapters: {
                    1: {
                        id: 1,
                        title: "Piping Materials and Standards - Chapter 1",
                        content: {
                            overview: "Gas piping materials, specifications, and standards",
                            approvedMaterials: [
                                "Black iron pipe (Schedule 40)",
                                "Galvanized steel pipe (outdoor use)",
                                "Copper tubing (Type K, L, ACR)",
                                "Corrugated stainless steel tubing (CSST)",
                                "Polyethylene (PE) pipe (underground)",
                                "Aluminum tubing (limited applications)"
                            ],
                            materialProperties: [
                                "Pressure ratings and temperature limits",
                                "Corrosion resistance characteristics",
                                "Thermal expansion considerations",
                                "Chemical compatibility with gas",
                                "Mechanical strength and durability"
                            ],
                            prohibitedMaterials: [
                                "Copper tubing in contact with ammonia",
                                "Aluminum tubing with manufactured gas",
                                "Cast iron pipe for gas service",
                                "PVC or other plastic pipes (except PE underground)",
                                "Soldered joints in gas piping systems"
                            ]
                        }
                    },
                    2: {
                        id: 2,
                        title: "Pipe Sizing and Calculations - Chapter 2",
                        content: {
                            overview: "Gas pipe sizing methods and pressure drop calculations",
                            sizingPrinciples: [
                                "Gas flow rate requirements (CFH or ft¬≥/hr)",
                                "Allowable pressure drop limitations",
                                "Equivalent pipe length calculations",
                                "Multiple appliance load calculations",
                                "Future expansion considerations"
                            ],
                            calculationMethods: [
                                "Longest run method for residential",
                                "Branch line method for complex systems",
                                "Computer modeling for large systems",
                                "Flow coefficient (Cv) calculations",
                                "Pressure drop verification methods"
                            ]
                        }
                    },
                    3: {
                        id: 3,
                        title: "Installation Methods and Techniques - Chapter 3",
                        content: {
                            overview: "Proper installation techniques for gas piping systems",
                            installationPlanning: [
                                "System layout and routing design",
                                "Material takeoff and ordering",
                                "Work sequence and scheduling",
                                "Access and workspace requirements",
                                "Safety planning and hazard assessment"
                            ],
                            pipingTechniques: [
                                "Proper pipe cutting and threading",
                                "Thread compound application",
                                "Joint assembly and tightening",
                                "Pipe support and anchoring methods",
                                "Expansion joint installation"
                            ]
                        }
                    },
                    4: {
                        id: 4,
                        title: "Joining Methods and Fittings - Chapter 4",
                        content: {
                            overview: "Gas piping joint types and fitting applications",
                            threadedJoints: [
                                "NPT (National Pipe Thread) standards",
                                "Thread cutting and preparation",
                                "Pipe thread sealants and compounds",
                                "Proper makeup and torque requirements",
                                "Quality inspection and testing"
                            ],
                            mechanicalJoints: [
                                "Flared tube connections",
                                "Compression fittings and ferrules",
                                "Union connections for maintenance",
                                "Quick-connect fittings",
                                "Grooved pipe connections"
                            ]
                        }
                    },
                    5: {
                        id: 5,
                        title: "System Components and Accessories - Chapter 5",
                        content: {
                            overview: "Gas system components beyond basic piping",
                            systemComponents: [
                                "Gas meters and measurement",
                                "Pressure regulators and control",
                                "Shut-off valves and emergency controls",
                                "Pressure relief devices",
                                "Dirt legs and drip traps"
                            ],
                            safetyDevices: [
                                "Excess flow valves",
                                "Earthquake shut-off valves",
                                "Manual shut-off valves",
                                "Emergency shut-off systems",
                                "Pressure monitoring devices"
                            ]
                        }
                    },
                    6: {
                        id: 6,
                        title: "Testing and Commissioning - Chapter 6",
                        content: {
                            overview: "Gas piping system testing and commissioning procedures",
                            testingRequirements: [
                                "Pressure testing before gas introduction",
                                "Leak testing of all joints",
                                "Flow testing for adequate capacity",
                                "Purging procedures for new systems",
                                "Final system verification"
                            ],
                            testProcedures: [
                                "System preparation for testing",
                                "Test medium selection and safety",
                                "Pressure application and monitoring",
                                "Leak detection methods and equipment",
                                "Test documentation and records"
                            ]
                        }
                    }
                },
                commonQuestions: [
                    {
                        question: "What's the difference between pipe and tubing in gas systems?",
                        answer: "Pipe is typically rigid (like black iron) with threaded connections, while tubing (like copper or CSST) is more flexible with mechanical fittings. Pipe is sized by nominal diameter, tubing by outside diameter. Both have specific applications and installation requirements."
                    },
                    {
                        question: "How do I calculate equivalent pipe length for fittings?",
                        answer: "Each fitting adds resistance equivalent to a certain length of straight pipe. For example, a 90¬∞ elbow might equal 3 feet of straight pipe. Add these equivalent lengths to your actual pipe length for sizing calculations."
                    },
                    {
                        question: "What thread sealant should I use on gas connections?",
                        answer: "Use only approved pipe thread sealants designed for gas service. Apply to male threads only, don't over-apply, and ensure it doesn't extend into the pipe bore where it could contaminate the gas system."
                    },
                    {
                        question: "Can I use CSST (corrugated stainless steel tubing) everywhere?",
                        answer: "CSST has specific installation requirements: it needs bonding for electrical safety, protection from damage, proper fittings, and cannot be used in certain locations like concealed spaces in some jurisdictions."
                    }
                ],
                materialComparison: [
                    {
                        material: "Black Iron Pipe",
                        advantages: ["Strong and durable", "Good for high pressure", "Threaded connections"],
                        disadvantages: ["Heavy", "Rust potential", "Labor intensive"],
                        applications: ["Indoor installations", "High pressure systems"]
                    },
                    {
                        material: "CSST",
                        advantages: ["Flexible", "Quick installation", "Earthquake resistant"],
                        disadvantages: ["Requires bonding", "Lightning protection", "Special tools"],
                        applications: ["New construction", "Renovation projects"]
                    }
                ]
            },
            9: {
                moduleId: 9,
                title: "Introduction to Gas Appliances",
                description: "Overview of gas appliances and their operation",
                chapters: {
                    1: {
                        id: 1,
                        title: "Gas Appliance Fundamentals - Chapter 1",
                        content: {
                            overview: "Basic principles of gas appliance operation",
                            applianceTypes: [
                                "Heating appliances (furnaces, boilers, space heaters)",
                                "Water heating equipment (tanks, tankless, indirect)",
                                "Cooking appliances (ranges, ovens, cooktops)",
                                "Clothes dryers and other utility appliances",
                                "Decorative appliances (fireplaces, logs)"
                            ],
                            operatingPrinciples: [
                                "Gas-air mixture and combustion",
                                "Heat transfer methods (conduction, convection, radiation)",
                                "Thermal efficiency and AFUE ratings",
                                "Combustion air requirements",
                                "Venting and exhaust principles"
                            ],
                            applianceClassification: [
                                "Input rating (BTU/hr capacity)",
                                "Efficiency ratings and standards",
                                "Venting categories (I, III, IV)",
                                "Installation types (residential, commercial)",
                                "Fuel types (natural gas, propane)"
                            ],
                            safetyFeatures: [
                                "Automatic shut-off systems",
                                "Flame detection devices",
                                "Temperature and pressure controls",
                                "Ventilation interlocks",
                                "Emergency shutdown mechanisms"
                            ]
                        }
                    },
                    2: {
                        id: 2,
                        title: "Combustion Systems and Burners - Chapter 2",
                        content: {
                            overview: "Gas burner types and combustion system components",
                            burnerTypes: [
                                "Atmospheric (natural draft) burners",
                                "Power (forced draft) burners",
                                "Premix burner systems",
                                "Ribbon and inshot burners",
                                "Modulating and staged burners"
                            ],
                            combustionComponents: [
                                "Gas valves and pressure regulators",
                                "Primary and secondary air controls",
                                "Ignition systems (pilot, direct spark, hot surface)",
                                "Flame detection and monitoring",
                                "Combustion chamber design"
                            ]
                        }
                    },
                    3: {
                        id: 3,
                        title: "Heat Exchangers and Heat Transfer - Chapter 3",
                        content: {
                            overview: "Heat exchanger design and heat transfer principles",
                            heatExchangerTypes: [
                                "Primary heat exchangers (non-condensing)",
                                "Secondary heat exchangers (condensing)",
                                "Tube and shell designs",
                                "Plate heat exchangers",
                                "Coil and serpentine designs"
                            ],
                            heatTransferMethods: [
                                "Conduction through metal surfaces",
                                "Convection heat transfer to air/water",
                                "Radiation heat transfer",
                                "Latent heat recovery (condensing)",
                                "Heat transfer efficiency factors"
                            ]
                        }
                    },
                    4: {
                        id: 4,
                        title: "Controls and Safety Systems - Chapter 4",
                        content: {
                            overview: "Gas appliance control systems and safety devices",
                            controlTypes: [
                                "Manual controls (pilot lights, manual valves)",
                                "Automatic controls (thermostats, aquastats)",
                                "Modulating controls (variable output)",
                                "Staged controls (multi-step operation)",
                                "Smart controls and programmable systems"
                            ],
                            safetyControls: [
                                "Flame detection systems (thermocouples, flame rods)",
                                "High temperature limit switches",
                                "Pressure switches (air, gas, water)",
                                "Flow switches and sensors",
                                "Rollout switches and spill detectors"
                            ]
                        }
                    },
                    5: {
                        id: 5,
                        title: "Venting Systems for Appliances - Chapter 5",
                        content: {
                            overview: "Appliance venting requirements and systems",
                            ventingPrinciples: [
                                "Natural draft operation",
                                "Induced draft systems",
                                "Direct vent applications",
                                "Power venting methods",
                                "Condensate management"
                            ],
                            ventingCategories: [
                                "Category I: Natural draft, non-condensing",
                                "Category III: Forced draft, non-condensing",
                                "Category IV: Condensing appliances",
                                "Direct vent: Sealed combustion",
                                "Vent-free: Special applications"
                            ]
                        }
                    },
                    6: {
                        id: 6,
                        title: "Installation Requirements - Chapter 6",
                        content: {
                            overview: "Gas appliance installation standards and procedures",
                            installationPlanning: [
                                "Location selection and requirements",
                                "Clearance measurements and verification",
                                "Utility connections planning",
                                "Access and service considerations",
                                "Code compliance verification"
                            ],
                            clearanceRequirements: [
                                "Clearances to combustible materials",
                                "Service and maintenance access",
                                "Air supply and ventilation clearances",
                                "Appliance-to-appliance spacing",
                                "Special clearance reductions"
                            ]
                        }
                    },
                    7: {
                        id: 7,
                        title: "Basic Troubleshooting - Chapter 7",
                        content: {
                            overview: "Basic gas appliance troubleshooting techniques",
                            diagnosticApproach: [
                                "Systematic troubleshooting methods",
                                "Safety checks before diagnosis",
                                "Visual inspection techniques",
                                "Performance measurement and testing",
                                "Component isolation and testing"
                            ],
                            commonProblems: [
                                "No ignition or flame establishment",
                                "Intermittent operation or cycling",
                                "Inadequate heat output",
                                "Excessive cycling or short cycling",
                                "Safety system lockouts"
                            ]
                        }
                    }
                },
                commonQuestions: [
                    {
                        question: "What's the difference between atmospheric and power burners?",
                        answer: "Atmospheric burners rely on natural draft and gas pressure to draw combustion air, while power burners use a fan to force air into the combustion chamber. Power burners provide better air-fuel mixing and can operate in tighter spaces."
                    },
                    {
                        question: "How do I determine the correct gas appliance size for a space?",
                        answer: "Calculate the heat loss of the space using factors like square footage, insulation, windows, and climate. Then select an appliance with BTU input that matches the calculated heat requirement, typically with 10-20% safety margin."
                    },
                    {
                        question: "What does AFUE rating mean and why is it important?",
                        answer: "AFUE (Annual Fuel Utilization Efficiency) measures how much fuel is converted to useful heat. An 80% AFUE means 80% of fuel becomes heat, 20% goes up the chimney. Higher AFUE means lower operating costs and better efficiency."
                    },
                    {
                        question: "Why do some appliances need outdoor combustion air?",
                        answer: "Tight homes may not have enough air infiltration for proper combustion. Outdoor air ensures adequate oxygen supply, prevents backdrafting, and maintains proper combustion air-fuel ratios for safe and efficient operation."
                    },
                    {
                        question: "What causes a yellow flame on gas appliances?",
                        answer: "Yellow flames indicate incomplete combustion due to insufficient primary air, dirty burners, improper gas pressure, or blocked air inlets. This produces carbon monoxide and reduces efficiency - requires immediate correction."
                    }
                ],
                troubleshootingGuide: [
                    {
                        problem: "Appliance won't ignite",
                        possibleCauses: [
                            "No gas supply or low pressure",
                            "Faulty ignition system",
                            "Safety lockout condition",
                            "Thermostat/control issues"
                        ],
                        diagnosticSteps: [
                            "Check gas supply and pressure",
                            "Verify electrical power",
                            "Test ignition components",
                            "Check safety controls"
                        ]
                    }
                ]
            }
        };

        // Global variables
        let chatHistory = [];
        let currentModule = null;
        let currentChapter = null;

        // Initialize the application
        window.onload = function() {
            initializeModuleSelector();
            updateContextInfo();
        };

        function initializeModuleSelector() {
            // Module selector is already populated in HTML
            document.getElementById('moduleSelect').addEventListener('change', handleModuleChange);
            document.getElementById('chapterSelect').addEventListener('change', handleChapterChange);
        }

        function handleModuleChange() {
            const moduleId = document.getElementById('moduleSelect').value;
            currentModule = moduleId;
            currentChapter = null;
            
            updateChapterSelector(moduleId);
            updateQuickTopics(moduleId);
            updateContextInfo();
            updateChatTitle();
        }

        function handleChapterChange() {
            const chapterId = document.getElementById('chapterSelect').value;
            currentChapter = chapterId;
            updateContextInfo();
            
            // Automatically display full chapter content when selected
            if (chapterId && currentModule) {
                displayChapterContent(currentModule, chapterId);
            }
        }

        // Function to display full chapter content automatically
        async function displayChapterContent(moduleId, chapterId) {
            const module = completeModuleData[moduleId];
            if (!module || !module.chapters || !module.chapters[chapterId]) {
                return;
            }
            
            const chapter = module.chapters[chapterId];
            showTypingIndicator();
            
            // Create comprehensive chapter content display
            let chapterContent = `# ${chapter.title}\n\n`;
            chapterContent += `**Module:** ${module.title}\n\n`;
            chapterContent += `## Overview\n${chapter.content.overview}\n\n`;
            
            // Display all content sections
            Object.entries(chapter.content).forEach(([key, value]) => {
                if (key === 'overview') return; // Already displayed
                
                const sectionTitle = key.replace(/([A-Z])/g, ' $1')
                    .replace(/^./, str => str.toUpperCase())
                    .trim();
                
                chapterContent += `## ${sectionTitle}\n\n`;
                
                if (Array.isArray(value)) {
                    value.forEach(item => {
                        chapterContent += `‚Ä¢ ${item}\n`;
                    });
                } else if (typeof value === 'object') {
                    Object.entries(value).forEach(([subKey, subValue]) => {
                        const subTitle = subKey.replace(/([A-Z])/g, ' $1')
                            .replace(/^./, str => str.toUpperCase())
                            .trim();
                        chapterContent += `### ${subTitle}\n`;
                        if (Array.isArray(subValue)) {
                            subValue.forEach(item => {
                                chapterContent += `‚Ä¢ ${item}\n`;
                            });
                        } else {
                            chapterContent += `${subValue}\n`;
                        }
                        chapterContent += '\n';
                    });
                } else {
                    chapterContent += `${value}\n`;
                }
                chapterContent += '\n';
            });
            
            // Add relevant questions if they exist
            if (module.commonQuestions) {
                const relevantQuestions = module.commonQuestions.filter(qa => 
                    qa.question.toLowerCase().includes(chapter.title.toLowerCase().split(' ')[0]) ||
                    qa.answer.toLowerCase().includes(chapter.title.toLowerCase().split(' ')[0])
                );
                
                if (relevantQuestions.length > 0) {
                    chapterContent += `## Common Questions for this Chapter\n\n`;
                    relevantQuestions.forEach(qa => {
                        chapterContent += `**Q: ${qa.question}**\n\n${qa.answer}\n\n`;
                    });
                }
            }
            
            chapterContent += `\n---\n\n*üí° Ask me to elaborate on any section, explain concepts in more detail, or provide practical examples for better understanding.*`;
            
            // Display the content
            await new Promise(resolve => setTimeout(resolve, 800));
            hideTypingIndicator();
            addMessage('ai', chapterContent);
        }

        function updateChapterSelector(moduleId) {
            const chapterSelector = document.getElementById('chapterSelector');
            const chapterSelect = document.getElementById('chapterSelect');
            
            if (!moduleId) {
                chapterSelector.style.display = 'none';
                return;
            }
            
            const module = completeModuleData[moduleId];
            if (!module || !module.chapters) {
                chapterSelector.style.display = 'none';
                return;
            }
            
            // Clear existing options
            chapterSelect.innerHTML = '<option value="">All Chapters</option>';
            
            // Add chapter options
            Object.values(module.chapters).forEach(chapter => {
                const option = document.createElement('option');
                option.value = chapter.id;
                option.textContent = chapter.title;
                chapterSelect.appendChild(option);
            });
            
            chapterSelector.style.display = 'block';
        }

        function updateContextInfo() {
            const contextInfo = document.getElementById('contextInfo');
            
            if (currentModule && currentChapter) {
                const module = completeModuleData[currentModule];
                if (module && module.chapters && module.chapters[currentChapter]) {
                    const chapter = module.chapters[currentChapter];
                    contextInfo.textContent = `${module.title} - ${chapter.title}`;
                } else {
                    contextInfo.textContent = 'Content Loading...';
                }
            } else if (currentModule) {
                const module = completeModuleData[currentModule];
                if (module) {
                    contextInfo.textContent = `${module.title} - All Chapters`;
                } else {
                    contextInfo.textContent = 'Module Loading...';
                }
            } else {
                contextInfo.textContent = 'Complete CSA Course Content Available';
            }
        }

        function updateChatTitle() {
            const chatTitle = document.getElementById('chatTitle');
            
            if (currentModule) {
                const module = completeModuleData[currentModule];
                if (module) {
                    chatTitle.textContent = `AI Tutor - ${module.title}`;
                } else {
                    chatTitle.textContent = 'AI Tutor - Loading...';
                }
            } else {
                chatTitle.textContent = 'AI Tutor Chat';
            }
        }

        function updateQuickTopics(moduleId) {
            const topicContainer = document.getElementById('topicButtons');
            
            if (!moduleId) {
                // Default general topics
                topicContainer.innerHTML = `
                    <button class="topic-btn" onclick="askQuestion('What are the fundamental safety principles for gas technicians?')">Safety Principles</button>
                    <button class="topic-btn" onclick="askQuestion('What PPE is required for gas work?')">PPE Requirements</button>
                    <button class="topic-btn" onclick="askQuestion('How do I perform proper leak testing?')">Leak Testing</button>
                    <button class="topic-btn" onclick="askQuestion('What are the properties of natural gas?')">Gas Properties</button>
                    <button class="topic-btn" onclick="askQuestion('What is CSA B149.1?')">CSA Codes</button>
                    <button class="topic-btn" onclick="askQuestion('Explain Ohm\\'s Law for gas appliances')">Electrical Basics</button>
                    <button class="topic-btn" onclick="askQuestion('How do I read technical drawings?')">Technical Drawings</button>
                    <button class="topic-btn" onclick="askQuestion('What are professional communication skills?')">Customer Relations</button>
                `;
                return;
            }
            
            const module = completeModuleData[moduleId];
            if (!module) return;
            
            // Generate module-specific topics
            let topicsHtml = '';
            
            // Add common questions from the module
            if (module.commonQuestions) {
                module.commonQuestions.forEach(qa => {
                    const shortQuestion = qa.question.length > 45 ? qa.question.substring(0, 45) + '...' : qa.question;
                    topicsHtml += `<button class="topic-btn" onclick="askQuestion('${qa.question.replace(/'/g, "\\'")}')">${shortQuestion}</button>`;
                });
            }
            
            // Add key topics from chapters
            Object.values(module.chapters).forEach((chapter, index) => {
                if (chapter.content && chapter.content.keyTopics && index < 2) {
                    chapter.content.keyTopics.slice(0, 3).forEach(topic => {
                        const shortTopic = topic.length > 35 ? topic.substring(0, 35) + '...' : topic;
                        topicsHtml += `<button class="topic-btn" onclick="askQuestion('Explain ${topic.toLowerCase()}')">‚≠≥ ${shortTopic}</button>`;
                    });
                }
            });
            
            topicContainer.innerHTML = topicsHtml;
        }

        // Chat functionality
        window.askQuestion = function(question) {
            document.getElementById('chatInput').value = question;
            sendMessage();
        };

        window.sendMessage = async function() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Add user message
            addMessage('user', message);
            input.value = '';
            showTypingIndicator();
            
            try {
                // Get AI response using complete module data
                const response = await getCompleteAIResponse(message);
                hideTypingIndicator();
                addMessage('ai', response);
            } catch (error) {
                hideTypingIndicator();
                addMessage('ai', "I'm having trouble accessing the course content. Please try again.");
                console.error('Error:', error);
            }
        };

        // Complete AI response system using all module data
        async function getCompleteAIResponse(userMessage) {
            await new Promise(resolve => setTimeout(resolve, 1200)); // Processing delay
            
            const lowerMessage = userMessage.toLowerCase();
            
            // If specific module/chapter selected, search there first
            if (currentModule) {
                const moduleResponse = await searchModuleContent(currentModule, currentChapter, lowerMessage, userMessage);
                if (moduleResponse) return moduleResponse;
            }
            
            // Search across all modules
            const globalResponse = await searchAllModulesContent(lowerMessage, userMessage);
            if (globalResponse) return globalResponse;
            
            // Fallback response
            return getGeneralGuidance(userMessage);
        }

        async function searchModuleContent(moduleId, chapterId, lowerMessage, originalMessage) {
            const module = completeModuleData[moduleId];
            if (!module) return null;
            
            // Check for elaboration requests
            if (isElaborationRequest(lowerMessage)) {
                return await handleElaborationRequest(module, chapterId, lowerMessage, originalMessage);
            }
            
            // Search in common questions first
            if (module.commonQuestions) {
                const matchingQA = module.commonQuestions.find(qa =>
                    lowerMessage.includes(qa.question.toLowerCase().split(' ').slice(0, 3).join(' ')) ||
                    qa.question.toLowerCase().includes(lowerMessage.split(' ')[0]) ||
                    lowerMessage.includes('what') && qa.question.toLowerCase().includes('what')
                );
                
                if (matchingQA) {
                    return formatDetailedResponse(module, null, matchingQA.question, matchingQA.answer, 'Q&A');
                }
            }
            
            // Search specific chapter if selected
            if (chapterId && module.chapters[chapterId]) {
                const chapter = module.chapters[chapterId];
                const chapterResponse = await searchChapterContent(module, chapter, lowerMessage, originalMessage);
                if (chapterResponse) return chapterResponse;
            }
            
            // Search all chapters in module
            for (const chapter of Object.values(module.chapters)) {
                const chapterResponse = await searchChapterContent(module, chapter, lowerMessage, originalMessage);
                if (chapterResponse) return chapterResponse;
            }
            
            return null;
        }

        // Check if user is asking for elaboration or more details
        function isElaborationRequest(message) {
            const elaborationKeywords = [
                'elaborate', 'explain more', 'tell me more', 'more detail', 'expand on',
                'break down', 'go deeper', 'examples', 'how does', 'why does',
                'what does this mean', 'clarify', 'simplify', 'give me an example'
            ];
            return elaborationKeywords.some(keyword => message.includes(keyword));
        }

        // Handle requests for elaboration on chapter content
        async function handleElaborationRequest(module, chapterId, lowerMessage, originalMessage) {
            if (!chapterId || !module.chapters[chapterId]) {
                return `I'd be happy to elaborate! Please select a specific chapter first, and I'll provide detailed explanations of any topic within that chapter.`;
            }

            const chapter = module.chapters[chapterId];
            const content = chapter.content;
            
            // Find what the user wants elaborated on
            const searchTerms = extractSearchTerms(lowerMessage);
            let bestMatch = null;
            let matchScore = 0;

            // Search through all content sections
            Object.entries(content).forEach(([sectionKey, sectionValue]) => {
                if (sectionKey === 'overview') return;
                
                const sectionText = JSON.stringify(sectionValue).toLowerCase();
                const score = searchTerms.reduce((acc, term) => {
                    return acc + (sectionText.includes(term) ? 1 : 0);
                }, 0);
                
                if (score > matchScore) {
                    matchScore = score;
                    bestMatch = { key: sectionKey, value: sectionValue, score };
                }
            });

            if (bestMatch && bestMatch.score > 0) {
                return generateDetailedElaboration(module, chapter, bestMatch.key, bestMatch.value);
            }

            // If no specific match, provide general elaboration guidance
            return generateChapterElaborationGuide(module, chapter);
        }

        // Generate detailed elaboration for specific content section
        function generateDetailedElaboration(module, chapter, sectionKey, sectionValue) {
            const sectionTitle = sectionKey.replace(/([A-Z])/g, ' $1')
                .replace(/^./, str => str.toUpperCase()).trim();
            
            let response = `## Detailed Explanation: ${sectionTitle}\n\n`;
            response += `**From Chapter:** ${chapter.title}\n`;
            response += `**Module:** ${module.title}\n\n`;

            if (Array.isArray(sectionValue)) {
                response += `This section covers ${sectionValue.length} key points:\n\n`;
                
                sectionValue.forEach((item, index) => {
                    response += `### ${index + 1}. ${item}\n\n`;
                    response += generateExplanationForItem(item, sectionKey, module.title) + '\n\n';
                });
                
            } else if (typeof sectionValue === 'object') {
                response += `This section includes several important categories:\n\n`;
                
                Object.entries(sectionValue).forEach(([subKey, subValue]) => {
                    const subTitle = subKey.replace(/([A-Z])/g, ' $1')
                        .replace(/^./, str => str.toUpperCase()).trim();
                    response += `### ${subTitle}\n\n`;
                    
                    if (Array.isArray(subValue)) {
                        subValue.forEach(item => {
                            response += `‚Ä¢ **${item}**\n`;
                            response += `  ${generateExplanationForItem(item, sectionKey, module.title)}\n\n`;
                        });
                    } else {
                        response += `${subValue}\n\n`;
                        response += generateExplanationForItem(subValue, sectionKey, module.title) + '\n\n';
                    }
                });
                
            } else {
                response += sectionValue + '\n\n';
                response += generateExplanationForItem(sectionValue, sectionKey, module.title) + '\n\n';
            }

            response += `---\n\n*üí° Need more specific details about any of these points? Just ask!*`;
            return response;
        }

        // Generate practical explanations for individual items
        function generateExplanationForItem(item, context, moduleTitle) {
            // Customer Relations specific explanations
            if (moduleTitle.includes('Customer Relations')) {
                if (item.includes('listening')) {
                    return `This means focusing completely on what the customer is saying, asking clarifying questions, and confirming your understanding before responding. For example, if a customer says "the furnace isn't working," ask "What specifically is happening - no heat, strange sounds, or something else?"`;
                }
                if (item.includes('professional')) {
                    return `This encompasses your appearance, communication style, and work habits. Arrive on time, wear clean uniforms, explain your work clearly, and treat the customer's home with respect.`;
                }
                if (item.includes('conflict') || item.includes('dispute')) {
                    return `When disagreements arise, stay calm, listen to concerns, acknowledge their feelings, and focus on finding solutions rather than placing blame. Document everything and involve supervision when needed.`;
                }
                if (item.includes('ethics') || item.includes('integrity')) {
                    return `Always be honest about problems found, costs involved, and your capabilities. Never cut corners on safety, and charge fairly for services provided. Your reputation depends on trustworthiness.`;
                }
            }

            // Safety specific explanations
            if (moduleTitle.includes('Safety')) {
                if (item.includes('PPE') || item.includes('protective')) {
                    return `Personal Protective Equipment must be selected based on the specific hazards present. For gas work, this typically includes safety glasses, steel-toed boots, and gas detectors. Inspect PPE daily and replace when damaged.`;
                }
                if (item.includes('gas detector') || item.includes('monitor')) {
                    return `Gas detection equipment must be calibrated regularly and tested before each use. LEL (Lower Explosive Limit) monitors detect combustible gas concentrations, while oxygen monitors ensure safe breathing air.`;
                }
                if (item.includes('emergency')) {
                    return `Emergency procedures must be practiced regularly and clearly posted. Know evacuation routes, emergency contacts, and gas shutoff locations. In gas emergencies, evacuate first, then call from a safe location.`;
                }
            }

            // Gas Properties explanations
            if (moduleTitle.includes('Gas') && moduleTitle.includes('Properties')) {
                if (item.includes('methane') || item.includes('natural gas')) {
                    return `Natural gas is primarily methane (CH4), which is lighter than air and will rise and disperse when leaked outdoors. However, in enclosed spaces it can accumulate near the ceiling, creating hazardous conditions.`;
                }
                if (item.includes('propane')) {
                    return `Propane (C3H8) is heavier than air and will sink to low areas when leaked. This makes basements, pits, and ground-level areas particularly dangerous for propane accumulation.`;
                }
                if (item.includes('combustion')) {
                    return `Combustion requires the right mixture of fuel and air (typically 4-15% gas in air for natural gas). Too little air creates incomplete combustion and carbon monoxide; too much air wastes energy.`;
                }
            }

            // Default explanation for any item
            return `This is an important concept in ${moduleTitle.toLowerCase()} that requires proper understanding and application in field work. Consider how this applies to real-world situations and safety requirements.`;
        }

        // Extract search terms from user message
        function extractSearchTerms(message) {
            const stopWords = ['the', 'a', 'an', 'and', 'or', 'but', 'in', 'on', 'at', 'to', 'for', 'of', 'with', 'by', 'about', 'can', 'you', 'please', 'tell', 'me', 'more', 'elaborate', 'explain'];
            return message.toLowerCase()
                .replace(/[^\w\s]/g, '')
                .split(' ')
                .filter(word => word.length > 2 && !stopWords.includes(word));
        }

        // Generate general elaboration guide for a chapter
        function generateChapterElaborationGuide(module, chapter) {
            let response = `# ${chapter.title} - Available for Detailed Explanation\n\n`;
            response += `I can provide detailed explanations on any section of this chapter. Here's what we can explore:\n\n`;

            Object.entries(chapter.content).forEach(([key, value]) => {
                if (key === 'overview') return;
                
                const sectionTitle = key.replace(/([A-Z])/g, ' $1')
                    .replace(/^./, str => str.toUpperCase()).trim();
                    
                const itemCount = Array.isArray(value) ? value.length : 
                                typeof value === 'object' ? Object.keys(value).length : 1;
                                
                response += `‚Ä¢ **${sectionTitle}** (${itemCount} key points)\n`;
            });

            response += `\n**Examples of what you can ask:**\n`;
            response += `‚Ä¢ "Elaborate on [specific topic]"\n`;
            response += `‚Ä¢ "Explain more about [section name]"\n`;
            response += `‚Ä¢ "Give me examples of [concept]"\n`;
            response += `‚Ä¢ "Break down [specific item]"\n`;
            response += `‚Ä¢ "How does [process] work?"\n\n`;
            response += `*Just mention any topic from above and I'll provide detailed explanations with practical examples!*`;

            return response;
        }

        function searchChapterContent(module, chapter, lowerMessage, originalMessage) {
            const content = chapter.content;
            if (!content) return null;
            
            // Check for specific content matches
            const contentSearches = [
                { key: 'safetyPrinciples', keywords: ['safety', 'principle'] },
                { key: 'primaryHazards', keywords: ['hazard', 'danger', 'risk'] },
                { key: 'basicPPE', keywords: ['ppe', 'protective', 'equipment'] },
                { key: 'specializedEquipment', keywords: ['equipment', 'detector', 'monitor'] },
                { key: 'essentialTools', keywords: ['tool', 'wrench', 'equipment'] },
                { key: 'threadedFasteners', keywords: ['thread', 'npt', 'bsp', 'fastener'] },
                { key: 'physicalProperties', keywords: ['property', 'properties', 'natural gas', 'propane'] },
                { key: 'chemicalComposition', keywords: ['composition', 'methane', 'chemical'] },
                { key: 'primaryCodes', keywords: ['code', 'csa', 'b149', 'regulation'] },
                { key: 'ohmsLaw', keywords: ['ohm', 'electrical', 'voltage', 'current'] },
                { key: 'applianceTypes', keywords: ['appliance', 'furnace', 'water heater'] },
                { key: 'burnerTypes', keywords: ['burner', 'atmospheric', 'power'] }
            ];
            
            for (const search of contentSearches) {
                if (search.keywords.some(keyword => lowerMessage.includes(keyword)) && content[search.key]) {
                    const contentArray = content[search.key];
                    return formatDetailedResponse(module, chapter, search.key, contentArray, 'content');
                }
            }
            
            // Check learning objectives
            if (lowerMessage.includes('objective') && content.learningObjectives) {
                return formatDetailedResponse(module, chapter, 'Learning Objectives', content.learningObjectives, 'objectives');
            }
            
            // Check key topics
            if (content.keyTopics) {
                const matchingTopic = content.keyTopics.find(topic =>
                    lowerMessage.includes(topic.toLowerCase()) ||
                    topic.toLowerCase().includes(lowerMessage.split(' ')[0])
                );
                
                if (matchingTopic) {
                    return formatDetailedResponse(module, chapter, matchingTopic, [content.overview], 'topic', matchingTopic);
                }
            }
            
            return null;
        }

        function formatDetailedResponse(module, chapter, title, content, type, specificTopic = null) {
            let response = `**${module.title}`;
            
            if (chapter) {
                response += ` - ${chapter.title}**\n\n`;
            } else {
                response += '**\n\n';
            }
            
            if (type === 'Q&A') {
                response += `‚ùì **${title}**\n\n${content}\n\n`;
            } else if (type === 'content' && Array.isArray(content)) {
                response += `üìã **${formatContentKey(title)}:**\n\n`;
                content.forEach((item, index) => {
                    response += `${index + 1}. ${item}\n`;
                });
                response += '\n';
            } else if (type === 'objectives' && Array.isArray(content)) {
                response += `üéØ **Learning Objectives:**\n\n`;
                content.forEach((obj, index) => {
                    response += `${index + 1}. ${obj}\n`;
                });
                response += '\n';
            } else if (type === 'topic') {
                response += `üìñ **${title}**\n\n${content[0]}\n\n`;
                if (chapter && chapter.content.keyTopics) {
                    response += `**Related Topics in this Chapter:**\n`;
                    chapter.content.keyTopics.filter(t => t !== specificTopic).slice(0, 3).forEach(topic => {
                        response += `‚Ä¢ ${topic}\n`;
                    });
                    response += '\n';
                }
            }
            
            response += `üîç **Want to learn more?** Ask me about specific procedures, requirements, or dive deeper into this topic!\n\n`;
            response += `üìö **Source:** ${module.title}`;
            if (chapter) response += ` - ${chapter.title}`;
            
            return response;
        }

        function formatContentKey(key) {
            const keyMap = {
                'safetyPrinciples': 'Safety Principles',
                'primaryHazards': 'Primary Hazards',
                'basicPPE': 'Basic Personal Protective Equipment',
                'specializedEquipment': 'Specialized Equipment',
                'essentialTools': 'Essential Tools',
                'threadedFasteners': 'Threaded Fasteners',
                'physicalProperties': 'Physical Properties',
                'chemicalComposition': 'Chemical Composition',
                'primaryCodes': 'Primary Codes',
                'ohmsLaw': "Ohm's Law",
                'applianceTypes': 'Appliance Types',
                'burnerTypes': 'Burner Types'
            };
            
            return keyMap[key] || key;
        }

        async function searchAllModulesContent(lowerMessage, originalMessage) {
            const results = [];
            
            Object.values(completeModuleData).forEach(module => {
                if (module.commonQuestions) {
                    module.commonQuestions.forEach(qa => {
                        if (lowerMessage.includes(qa.question.toLowerCase().split(' ').slice(0, 2).join(' '))) {
                            results.push({
                                module: module,
                                type: 'Q&A',
                                title: qa.question,
                                content: qa.answer
                            });
                        }
                    });
                }
                
                Object.values(module.chapters).forEach(chapter => {
                    if (chapter.content && chapter.content.keyTopics) {
                        chapter.content.keyTopics.forEach(topic => {
                            if (lowerMessage.includes(topic.toLowerCase().split(' ')[0])) {
                                results.push({
                                    module: module,
                                    chapter: chapter,
                                    type: 'topic',
                                    title: topic,
                                    content: chapter.content.overview || 'Related content available'
                                });
                            }
                        });
                    }
                });
            });
            
            if (results.length > 0) {
                return formatMultiModuleResponse(results, originalMessage);
            }
            
            return null;
        }

        function formatMultiModuleResponse(results, originalMessage) {
            if (results.length === 1) {
                const result = results[0];
                return formatDetailedResponse(result.module, result.chapter, result.title, result.content, result.type);
            }
            
            let response = `**Found "${originalMessage}" across multiple modules:**\n\n`;
            
            const moduleGroups = {};
            results.forEach(result => {
                if (!moduleGroups[result.module.moduleId]) {
                    moduleGroups[result.module.moduleId] = {
                        module: result.module,
                        items: []
                    };
                }
                moduleGroups[result.module.moduleId].items.push(result);
            });
            
            Object.values(moduleGroups).forEach(group => {
                response += `üìö **Module ${group.module.moduleId}: ${group.module.title}**\n`;
                group.items.slice(0, 2).forEach(item => {
                    response += `   ‚Ä¢ ${item.title}\n`;
                });
                if (group.items.length > 2) {
                    response += `   ‚Ä¢ ... and ${group.items.length - 2} more topics\n`;
                }
                response += '\n';
            });
            
            response += `üí° **Tip:** Select a specific module from the sidebar for detailed information!`;
            
            return response;
        }

        function getGeneralGuidance(originalMessage) {
            return `I'd be happy to help you with "${originalMessage}"!\n\n**üìö I have complete access to all CSA Gas Technician course content:**\n\n**Module 1:** Safety principles, PPE, hazards, emergency procedures\n**Module 2:** Tools, fasteners, testing equipment, NPT threads\n**Module 3:** Gas properties, natural gas vs propane, combustion\n**Module 4:** CSA codes (B149.1, B149.2), regulations, licensing\n**Module 5:** Electrical basics, Ohm's Law, motors, controls\n**Module 6:** Technical drawings, P&IDs, specifications\n**Module 7:** Customer relations, communication, professionalism\n**Module 8:** Piping systems, materials, sizing, installation\n**Module 9:** Gas appliances, burners, venting, troubleshooting\n\n**üí° For better results:**\n‚Ä¢ Try selecting a specific module from the sidebar\n‚Ä¢ Ask about specific procedures or concepts\n‚Ä¢ Request examples or step-by-step explanations\n\nWhat specific topic would you like to explore?`;
        }

        function addMessage(sender, content) {
            const messagesContainer = document.getElementById('chatMessages');
            
            // Hide welcome message if it exists
            const welcomeMessage = messagesContainer.querySelector('.welcome-message');
            if (welcomeMessage) {
                welcomeMessage.style.display = 'none';
            }
            
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            
            const time = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            
            messageDiv.innerHTML = `
                <div class="message-bubble">
                    ${content.replace(/\n/g, '<br>').replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/‚Ä¢ /g, '‚Ä¢ ')}
                </div>
                <div class="message-time">${time}</div>
            `;
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function showTypingIndicator() {
            document.getElementById('typingIndicator').style.display = 'block';
            document.getElementById('sendBtn').disabled = true;
            
            const messagesContainer = document.getElementById('chatMessages');
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function hideTypingIndicator() {
            document.getElementById('typingIndicator').style.display = 'none';
            document.getElementById('sendBtn').disabled = false;
        }

        // Enter key to send message
        document.getElementById('chatInput').addEventListener('keydown', function(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        });

        // Auto-resize textarea
        document.getElementById('chatInput').addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = Math.min(this.scrollHeight, 120) + 'px';
        });

        console.log('G3 AI Tutor with Complete CSA Content initialized successfully!');
        console.log(`Loaded ${Object.keys(completeModuleData).length} modules with comprehensive content`);
    </script>
</body>
</html>